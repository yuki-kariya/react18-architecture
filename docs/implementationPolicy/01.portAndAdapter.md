# Port & Adapter 実装ルール

Port とは、インターネット、DB、ストレージといったアプリケーション外部とのインターフェースのことを指す。

Adapter は Port の実装を指す。

Port は Adapter に対する「誓約事項」とも解釈でき、その制約の範囲内では実装を容易に切り替えることができる。

## Port フォルダ構成のルール

### 基本ルール

外部接続先に応じてディレクトリは分離する。

> `ports/{外部接続先}`

### api

同サービス提供の API ポートは、以下ディレクトリに作成する。

> `ports/api`

API の I/O は以下のディレクトリに作成する。

> `ports/api/types`

API の I/O 定義には、共通するデータ構造をスキーマとして再利用可能な形で定義されていることが多い。

再利用したいデータ構造は以下のディレクトリにに作成する。

> `ports/api/types/schemas`

### その他

ストレージ、JsBridge、外部サービスなどの Port は、基本ルールに従ってディレクトリを作成する。

例）ストレージの場合

> `ports/storage`

I/O 定義については、外部接続先に合わせて作成する。

ただし、接続先が RESTAPI の場合は、同サービス提供の API と同じディレクトリ・ファイル構成を推奨する。

## Port 実装ルール

```ts
// ports/api/types/schemas/Gender.ts
export type Gender = "male" | "female" | "unknown";

// ports/api/types/schemas/User.ts
import { Gender } from "./schemas";

export interface User {
  userId: string;
  nickName: string;
  birthday: string;
  gender?: Gender;
}

// ports/api/types/FetchUserRequest.ts
export interface FetchUserRequest {
  userId: string;
}

// ports/api/types/FetchUserResponse.ts
import { User } from "./schemas";

export type FetchuserResponse = User;

// ports/api/UserApiPort.ts
import { FetchUserRequest, FetchUserResponse } from "./types";

export interface UserApiPort {
  fetchUser: (request: FetchUserRequest) => Promise<FetchUserResponse>;
}
```

## メモ

DTO の型定義は、Swagger から自動出力できるようにしたい。
